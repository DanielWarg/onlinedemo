{
	# Tailscale Funnel terminates TLS. Caddy should NOT manage TLS here.
	auto_https off
}

:8443 {
	# Security headers (showreel-safe)
	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "no-referrer"
		# Allow mic/camera for showreel features (r√∂stmemo + bild i anteckningar).
		Permissions-Policy "geolocation=(), microphone=(self), camera=(self)"
		# Avoid stale index.html in demo debugging; Vite assets are hashed anyway.
		Cache-Control "no-store"
	}

	# Health directly from API
	handle /health* {
		reverse_proxy {$API_UPSTREAM}
	}

	# API (keep /api prefix; backend expects /api/*)
	handle /api/* {
		reverse_proxy {$API_UPSTREAM}
	}

	# Frontend static (Vite build output)
	handle {
		root * {$WEB_DIST}
		try_files {path} /index.html
		file_server
	}
}

